<!doctype html>
<html>
  <head>
    <title>{{tenant.dashboard_title}}</title>

    {% include("components/common_head.html") %}
    <style>
      {% include("components/common_style.css") %}

      main {
        display: grid;
        grid-gap: 1rem;
        grid-template-columns: 75vh 1fr 75vh;
        grid-template-rows: auto 55vh auto;
        grid-template-areas:
          'map summary summary'
          'map subregionwiseDistribution subregionwiseDistribution'
          'trends trends featureDistributions'
        ;
        padding: 1rem max(2rem, calc(50vw - 640px));
      }

      .component-card {
        box-shadow: 0px 0px 2px 0px rgba(0, 0, 0, 0.08), 0px 1px 4px 0px rgba(69, 75, 87, 0.12), 0px 0px 0px 1px rgba(152, 161, 178, 0.10);
        padding: 0.75rem;
        border-radius: 0.5rem;
        background: var(--bg2);
        place-self: stretch;
      }

      .component-card h2 {
        font-size: 1rem;
      }
    </style>
    <script>
      const csrfToken = "{{csrf_token()}}";
      const onDataLoad = [];
      let data;
      async function loadData() {
        const response = await fetch("/api/data/query", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": csrfToken,
          },
          body: JSON.stringify({
            region_id: "state_29",
            start_date: "2024-02-01",
            end_date: "2024-02-29",
            aggregates: [
              "summary",
              "subregionwise_distribution",
              "feature_distributions",
              "trends",
            ],
          }),
        });
        data = await response.json();
        onDataLoad.forEach((fn) => {
          fn(data);
        });
      }
      window.addEventListener("load", loadData);

      function downloadAsFile(text, filename) {
        var element = document.createElement("a");
        element.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," + encodeURIComponent(text),
        );
        element.setAttribute("download", filename);
        element.style.display = "none";
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
      }
    </script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="/static/js/papaparse.min.js"></script>
  </head>
  <body>
    {% include("components/header.html") %}
    <main>
      <!-- -->
      {% include("components/map.html") %}
      <!-- -->
      {% include("components/summary.html") %}
      <!-- -->
      {% include("components/feature_distributions.html") %}
      <!-- -->
      {% include("components/subregionwise_distribution.html") %}
      <!-- -->
      {% include("components/trends.html") %}
    </main>
  </body>
</html>
